{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ServerRequest",
  "description": "Request initiated from the server and sent to the client.",
  "oneOf": [
    {
      "description": "NEW APIs Sent when approval is requested for a specific command execution. This request is used for Turns started via turn/start.",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "item/commandExecution/requestApproval"
          ],
          "title": "Item/commandExecution/requestApprovalRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/CommandExecutionRequestApprovalParams"
        }
      },
      "title": "Item/commandExecution/requestApprovalRequest"
    },
    {
      "description": "Sent when approval is requested for a specific file change. This request is used for Turns started via turn/start.",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "item/fileChange/requestApproval"
          ],
          "title": "Item/fileChange/requestApprovalRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/FileChangeRequestApprovalParams"
        }
      },
      "title": "Item/fileChange/requestApprovalRequest"
    },
    {
      "description": "EXPERIMENTAL - Request input from the user for a tool call.",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "item/tool/requestUserInput"
          ],
          "title": "Item/tool/requestUserInputRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/ToolRequestUserInputParams"
        }
      },
      "title": "Item/tool/requestUserInputRequest"
    },
    {
      "description": "Execute a dynamic tool call on the client.",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "item/tool/call"
          ],
          "title": "Item/tool/callRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/DynamicToolCallParams"
        }
      },
      "title": "Item/tool/callRequest"
    },
    {
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "account/chatgptAuthTokens/refresh"
          ],
          "title": "Account/chatgptAuthTokens/refreshRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/ChatgptAuthTokensRefreshParams"
        }
      },
      "title": "Account/chatgptAuthTokens/refreshRequest"
    },
    {
      "description": "DEPRECATED APIs below Request to approve a patch. This request is used for Turns started via the legacy APIs (i.e. SendUserTurn, SendUserMessage).",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "applyPatchApproval"
          ],
          "title": "ApplyPatchApprovalRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/ApplyPatchApprovalParams"
        }
      },
      "title": "ApplyPatchApprovalRequest"
    },
    {
      "description": "Request to exec a command. This request is used for Turns started via the legacy APIs (i.e. SendUserTurn, SendUserMessage).",
      "type": "object",
      "required": [
        "id",
        "method",
        "params"
      ],
      "properties": {
        "id": {
          "$ref": "#/definitions/RequestId"
        },
        "method": {
          "type": "string",
          "enum": [
            "execCommandApproval"
          ],
          "title": "ExecCommandApprovalRequestMethod"
        },
        "params": {
          "$ref": "#/definitions/ExecCommandApprovalParams"
        }
      },
      "title": "ExecCommandApprovalRequest"
    }
  ],
  "definitions": {
    "ApplyPatchApprovalParams": {
      "type": "object",
      "required": [
        "callId",
        "conversationId",
        "fileChanges"
      ],
      "properties": {
        "callId": {
          "description": "Use to correlate this with [codex_core::protocol::PatchApplyBeginEvent] and [codex_core::protocol::PatchApplyEndEvent].",
          "type": "string"
        },
        "conversationId": {
          "$ref": "#/definitions/ThreadId"
        },
        "fileChanges": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/FileChange"
          }
        },
        "grantRoot": {
          "description": "When set, the agent is asking the user to allow writes under this root for the remainder of the session (unclear if this is honored today).",
          "type": [
            "string",
            "null"
          ]
        },
        "reason": {
          "description": "Optional explanatory reason (e.g. request for extra write access).",
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "ChatgptAuthTokensRefreshParams": {
      "type": "object",
      "required": [
        "reason"
      ],
      "properties": {
        "previousAccountId": {
          "description": "Workspace/account identifier that Codex was previously using.\n\nClients that manage multiple accounts/workspaces can use this as a hint to refresh the token for the correct workspace.\n\nThis may be `null` when the prior auth state did not include a workspace identifier (`chatgpt_account_id`).",
          "type": [
            "string",
            "null"
          ]
        },
        "reason": {
          "$ref": "#/definitions/ChatgptAuthTokensRefreshReason"
        }
      }
    },
    "ChatgptAuthTokensRefreshReason": {
      "oneOf": [
        {
          "description": "Codex attempted a backend request and received `401 Unauthorized`.",
          "type": "string",
          "enum": [
            "unauthorized"
          ]
        }
      ]
    },
    "CommandAction": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "command",
            "name",
            "path",
            "type"
          ],
          "properties": {
            "command": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "path": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "read"
              ],
              "title": "ReadCommandActionType"
            }
          },
          "title": "ReadCommandAction"
        },
        {
          "type": "object",
          "required": [
            "command",
            "type"
          ],
          "properties": {
            "command": {
              "type": "string"
            },
            "path": {
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "type": "string",
              "enum": [
                "listFiles"
              ],
              "title": "ListFilesCommandActionType"
            }
          },
          "title": "ListFilesCommandAction"
        },
        {
          "type": "object",
          "required": [
            "command",
            "type"
          ],
          "properties": {
            "command": {
              "type": "string"
            },
            "path": {
              "type": [
                "string",
                "null"
              ]
            },
            "query": {
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "type": "string",
              "enum": [
                "search"
              ],
              "title": "SearchCommandActionType"
            }
          },
          "title": "SearchCommandAction"
        },
        {
          "type": "object",
          "required": [
            "command",
            "type"
          ],
          "properties": {
            "command": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "unknown"
              ],
              "title": "UnknownCommandActionType"
            }
          },
          "title": "UnknownCommandAction"
        }
      ]
    },
    "CommandExecutionRequestApprovalParams": {
      "type": "object",
      "required": [
        "itemId",
        "threadId",
        "turnId"
      ],
      "properties": {
        "command": {
          "description": "The command to be executed.",
          "type": [
            "string",
            "null"
          ]
        },
        "commandActions": {
          "description": "Best-effort parsed command actions for friendly display.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/definitions/CommandAction"
          }
        },
        "cwd": {
          "description": "The command's working directory.",
          "type": [
            "string",
            "null"
          ]
        },
        "itemId": {
          "type": "string"
        },
        "proposedExecpolicyAmendment": {
          "description": "Optional proposed execpolicy amendment to allow similar commands without prompting.",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        },
        "reason": {
          "description": "Optional explanatory reason (e.g. request for network access).",
          "type": [
            "string",
            "null"
          ]
        },
        "threadId": {
          "type": "string"
        },
        "turnId": {
          "type": "string"
        }
      }
    },
    "DynamicToolCallParams": {
      "type": "object",
      "required": [
        "arguments",
        "callId",
        "threadId",
        "tool",
        "turnId"
      ],
      "properties": {
        "arguments": true,
        "callId": {
          "type": "string"
        },
        "threadId": {
          "type": "string"
        },
        "tool": {
          "type": "string"
        },
        "turnId": {
          "type": "string"
        }
      }
    },
    "ExecCommandApprovalParams": {
      "type": "object",
      "required": [
        "callId",
        "command",
        "conversationId",
        "cwd",
        "parsedCmd"
      ],
      "properties": {
        "callId": {
          "description": "Use to correlate this with [codex_core::protocol::ExecCommandBeginEvent] and [codex_core::protocol::ExecCommandEndEvent].",
          "type": "string"
        },
        "command": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "conversationId": {
          "$ref": "#/definitions/ThreadId"
        },
        "cwd": {
          "type": "string"
        },
        "parsedCmd": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ParsedCommand"
          }
        },
        "reason": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "FileChange": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "content",
            "type"
          ],
          "properties": {
            "content": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "add"
              ],
              "title": "AddFileChangeType"
            }
          },
          "title": "AddFileChange"
        },
        {
          "type": "object",
          "required": [
            "content",
            "type"
          ],
          "properties": {
            "content": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "delete"
              ],
              "title": "DeleteFileChangeType"
            }
          },
          "title": "DeleteFileChange"
        },
        {
          "type": "object",
          "required": [
            "type",
            "unified_diff"
          ],
          "properties": {
            "move_path": {
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "type": "string",
              "enum": [
                "update"
              ],
              "title": "UpdateFileChangeType"
            },
            "unified_diff": {
              "type": "string"
            }
          },
          "title": "UpdateFileChange"
        }
      ]
    },
    "FileChangeRequestApprovalParams": {
      "type": "object",
      "required": [
        "itemId",
        "threadId",
        "turnId"
      ],
      "properties": {
        "grantRoot": {
          "description": "[UNSTABLE] When set, the agent is asking the user to allow writes under this root for the remainder of the session (unclear if this is honored today).",
          "type": [
            "string",
            "null"
          ]
        },
        "itemId": {
          "type": "string"
        },
        "reason": {
          "description": "Optional explanatory reason (e.g. request for extra write access).",
          "type": [
            "string",
            "null"
          ]
        },
        "threadId": {
          "type": "string"
        },
        "turnId": {
          "type": "string"
        }
      }
    },
    "ParsedCommand": {
      "oneOf": [
        {
          "type": "object",
          "required": [
            "cmd",
            "name",
            "path",
            "type"
          ],
          "properties": {
            "cmd": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "path": {
              "description": "(Best effort) Path to the file being read by the command. When possible, this is an absolute path, though when relative, it should be resolved against the `cwd`` that will be used to run the command to derive the absolute path.",
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "read"
              ],
              "title": "ReadParsedCommandType"
            }
          },
          "title": "ReadParsedCommand"
        },
        {
          "type": "object",
          "required": [
            "cmd",
            "type"
          ],
          "properties": {
            "cmd": {
              "type": "string"
            },
            "path": {
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "type": "string",
              "enum": [
                "list_files"
              ],
              "title": "ListFilesParsedCommandType"
            }
          },
          "title": "ListFilesParsedCommand"
        },
        {
          "type": "object",
          "required": [
            "cmd",
            "type"
          ],
          "properties": {
            "cmd": {
              "type": "string"
            },
            "path": {
              "type": [
                "string",
                "null"
              ]
            },
            "query": {
              "type": [
                "string",
                "null"
              ]
            },
            "type": {
              "type": "string",
              "enum": [
                "search"
              ],
              "title": "SearchParsedCommandType"
            }
          },
          "title": "SearchParsedCommand"
        },
        {
          "type": "object",
          "required": [
            "cmd",
            "type"
          ],
          "properties": {
            "cmd": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": [
                "unknown"
              ],
              "title": "UnknownParsedCommandType"
            }
          },
          "title": "UnknownParsedCommand"
        }
      ]
    },
    "RequestId": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "integer",
          "format": "int64"
        }
      ]
    },
    "ThreadId": {
      "type": "string"
    },
    "ToolRequestUserInputOption": {
      "description": "EXPERIMENTAL. Defines a single selectable option for request_user_input.",
      "type": "object",
      "required": [
        "description",
        "label"
      ],
      "properties": {
        "description": {
          "type": "string"
        },
        "label": {
          "type": "string"
        }
      }
    },
    "ToolRequestUserInputParams": {
      "description": "EXPERIMENTAL. Params sent with a request_user_input event.",
      "type": "object",
      "required": [
        "itemId",
        "questions",
        "threadId",
        "turnId"
      ],
      "properties": {
        "itemId": {
          "type": "string"
        },
        "questions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ToolRequestUserInputQuestion"
          }
        },
        "threadId": {
          "type": "string"
        },
        "turnId": {
          "type": "string"
        }
      }
    },
    "ToolRequestUserInputQuestion": {
      "description": "EXPERIMENTAL. Represents one request_user_input question and its required options.",
      "type": "object",
      "required": [
        "header",
        "id",
        "question"
      ],
      "properties": {
        "header": {
          "type": "string"
        },
        "id": {
          "type": "string"
        },
        "isOther": {
          "default": false,
          "type": "boolean"
        },
        "isSecret": {
          "default": false,
          "type": "boolean"
        },
        "options": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/definitions/ToolRequestUserInputOption"
          }
        },
        "question": {
          "type": "string"
        }
      }
    }
  }
}